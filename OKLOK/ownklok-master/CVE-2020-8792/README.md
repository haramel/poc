# CVE-2020-8792
>The OKLOK (3.1.1) mobile companion app for Fingerprint Bluetooth Padlock FB50 (2.3) has an information-exposure issue. In the mobile app, an attempt to add an already-bound lock by its barcode reveals the email address of the account to which the lock is bound, as well as the name of the lock. Valid barcode inputs can be easily guessed because barcode strings follow a predictable pattern. Correctly guessed valid barcode inputs entered through the app interface disclose arbitrary users' email addresses and lock names. 

**Note:** This vulnerability can be chained with CVE-2020-8791 in order to retrieve additional user account information for any list of arbitrary barcode iputs.

## ownklok_barcode.py
>PoC to construct valid barcodes from numeric inputs and discover account email addresses and owner-assigned lock names.

## ownklok_chain.py
>Chain ownklok_barcode.py and CVE-2020-8791 to collect email address, owner-assigned lock name, unsalted MD5 password hash, owner-assigned fingerprint name, and more.

## Usage
```python3 ownklok_barcode.py <number> <attacker_email_address>``` <br/>
```python3 ownklok_chain.py <number> <attacker_email_address>```

`<number>` = the number part of the barcode (barcode follows the format '<4 alpha chars> + <8 digits 0-padded left>')<br/>
`<attacker_email_address>` = the email address of the attacker account, which will be used to generate an accepted token for the HTTP headers

**Disclaimer:**
Use these scripts/methods only against your own barcodes or barcodes you have permission to test. To check your barcode ID, look at the QR code sticker that comes with the product, or use ownklok_idor.py or one of the attack_scenario*.py exploits to find your barcode. 

## Demos
Details are redacted in the demos. 

### Mobile App Interface Disclosure
To reproduce the information disclosure in the app, bind a lock to a "victim" account and then try to bind it by its barcode to an "attacker" account. Manually enter the barcode into "Add by ID No." on the "attacker" account. The app will display the email address of the account to which the lock is bound, as well as the lock name assigned by the owner.

<img src=../screenshots/mobile_app_info_disclosure_step1.PNG width="200"/> <img src=../screenshots/mobile_app_info_disclosure_step2.PNG width="200"/> <img src=../screenshots/mobile_app_info_disclosure_step3.PNG width="200"/>

### ownklok_barcode.py demo
Choose the prefix that corresponds to your lock's barcode. Known prefixes are included in the menu, along with an "other" option in case there are prefixes that were not known at the time of writing the PoC. 

![alt text](../screenshots/ownklok_barcode_demo.png)

### ownklok_chain.py demo
The additional user account information at the bottom represents the "chain" to CVE-2020-8791.

![alt text](../screenshots/ownklok_chain_demo.png)
